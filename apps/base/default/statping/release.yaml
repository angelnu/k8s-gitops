apiVersion: helm.toolkit.fluxcd.io/v2beta1
kind: HelmRelease
metadata:
  name: statping
spec:
  interval: 5m
  chart:
    spec:
      # renovate: registryUrl=https://k8s-at-home.com/charts/
      chart: statping
      version: 2.0.0
      sourceRef:
        kind: HelmRepository
        #name: k8s-at-home-charts
        name: angelnu-charts
        namespace: flux-system
      interval: 5m
  dependsOn:
    - name: statping-db
  # See https://github.com/k8s-at-home/charts/blob/master/charts/statping/values.yaml
  values:
    image:
      repository: statping/statping
      tag: "v0.90.74"

    
    env:
      # -- Name of the Statping instance
      NAME: Casa96
      # -- Description of the Statping instance
      DESCRIPTION: Statpling status for casa96
      # -- External URL you use to connect to the statping (the one you enter in your browser)
      VIRTUAL_HOST: "status.pub.angelnu.com"
      # -- Type of database to use
      DB_CONN: postgres
      # -- Postgres database hostname
      # @default -- internal postgresql URL
      DB_HOST: "statping-db-postgres-cluster-postgres"
      # -- Enable ssl_mode for postgres (To enable use require)
      POSTGRES_SSLMODE: "require"
      # -- Postgres database user name
      # @default -- postgresql.postgresqlUsername value
      DB_USER: "postgres"
      # -- Postgres database password
      # @default -- postgresql.postgresqlPassword value
      # DB_PASS: "" set in secret
      # -- Postgres database password
      # @default -- postgresql.postgresqlDatabase value
      DB_DATABASE: "postgres"
      # -- dashboard admin user (needed to edit)
      # ADMIN_USER: set in secret
      # -- dashboard admin password (needed to edit)
      # ADMIN_PASSWORD: set secret
      # -- dashboard admin email
      #ADMIN_EMAIL: set secret
      # -- Use CDN for static context from third-parties
      USE_CDN: false
      # -- Disable logs from appearing and writing to disk
      DISABLE_LOGS: false

    ingress:
      enabled: true
      annotations:
        nginx.ingress.kubernetes.io/proxy-body-size: "8000m"
      #  nginx.ingress.kubernetes.io/auth-url: "https://ingress-auth.${CLUSTER_DOMAIN}/auth"
      #  nginx.ingress.kubernetes.io/auth-signin: "https://ingress-auth.${CLUSTER_DOMAIN}/start?rd=$scheme://$host$request_uri"
      ingress.kubernetes.io/ssl-redirect: "true"
      hosts:
      - host: status.pub.${CLUSTER_DOMAIN}
        paths:
        - path: /
          # Ignored if not kubeVersion >= 1.14-0
          pathType: Prefix
      - host: status.home.${CLUSTER_DOMAIN}
        paths:
        - path: /
          # Ignored if not kubeVersion >= 1.14-0
          pathType: Prefix
      tls:
      - hosts:
        - status.pub.${CLUSTER_DOMAIN}
        - status.home.${CLUSTER_DOMAIN}
    
    postgresql:
      enabled: false
    persistence: {}

  valuesFrom:
  - kind: Secret
    name: "statping-helm-values"
    valuesKey: statping.yaml
    optional: false